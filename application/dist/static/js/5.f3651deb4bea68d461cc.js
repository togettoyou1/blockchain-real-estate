webpackJsonp([5],{HuSN:function(e,t){},phQZ:function(e,t,a){"use strict";t.a=function(e){return o.a({url:"/createDrugRequest",method:"post",data:e})},t.b=function(e){return o.a({url:"/queryDrugRequestList",method:"post",data:e})};var o=a("vLgD")},"qw+2":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("Dd8w"),r=a.n(o),n=a("NYxO"),i=a("nv77"),l=a("phQZ"),s=a("+OSn"),c=a("raiF"),u={name:"DrugRequest",data:function(){var e=function(e,t,a){t<=0?a(new Error("必须大于0")):a()};return{loading:!0,loadingDialog:!1,drugRequestList:[],dialogCreateSelling:!1,dialogCreateDonating:!1,realForm:{price:0,salePeriod:0},rules:{price:[{validator:e,trigger:"blur"}],salePeriod:[{validator:e,trigger:"blur"}]},DonatingForm:{proprietor:""},rulesDonating:{proprietor:[{required:!0,message:"请选择用户",trigger:"change"}]},accountList:[],valItem:{}}},computed:r.a({},n.b(["accountId","roles","userName","balance"])),created:function(){var e=this;l.b().then(function(t){null!==t&&(e.drugRequestList=t),e.loading=!1}).catch(function(t){e.loading=!1})},methods:{openDialog:function(e){this.dialogCreateSelling=!0,this.valItem=e},openDonatingDialog:function(e){var t=this;this.dialogCreateDonating=!0,this.valItem=e,i.c().then(function(e){null!==e&&(t.accountList=e.filter(function(e){return"管理员"!==e.userName&&e.accountId!==t.accountId}))})},createSelling:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$confirm("是否立即出售?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){t.loadingDialog=!0,s.a({objectOfSale:t.valItem.drugRequestId,seller:t.valItem.proprietor,price:t.realForm.price,salePeriod:t.realForm.salePeriod}).then(function(e){t.loadingDialog=!1,t.dialogCreateSelling=!1,null!==e?t.$message({type:"success",message:"出售成功!"}):t.$message({type:"error",message:"出售失败!"}),setTimeout(function(){window.location.reload()},1e3)}).catch(function(e){t.loadingDialog=!1,t.dialogCreateSelling=!1})}).catch(function(){t.loadingDialog=!1,t.dialogCreateSelling=!1,t.$message({type:"info",message:"已取消出售"})})})},createDonating:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$confirm("是否立即捐赠?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){t.loadingDialog=!0,c.a({objectOfDonating:t.valItem.drugRequestId,donor:t.valItem.proprietor,grantee:t.DonatingForm.proprietor}).then(function(e){t.loadingDialog=!1,t.dialogCreateDonating=!1,null!==e?t.$message({type:"success",message:"捐赠成功!"}):t.$message({type:"error",message:"捐赠失败!"}),setTimeout(function(){window.location.reload()},1e3)}).catch(function(e){t.loadingDialog=!1,t.dialogCreateDonating=!1})}).catch(function(){t.loadingDialog=!1,t.dialogCreateDonating=!1,t.$message({type:"info",message:"已取消捐赠"})})})},resetForm:function(e){this.$refs[e].resetFields()},selectGet:function(e){this.DonatingForm.proprietor=e}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-alert",{attrs:{type:"success"}},[a("p",[e._v("账户ID: "+e._s(e.accountId))]),e._v(" "),a("p",[e._v("用户名: "+e._s(e.userName))]),e._v(" "),a("p",[e._v("余额: ￥"+e._s(e.balance)+" 元")]),e._v(" "),a("p",[e._v("当发起出售、捐赠或质押操作后，担保状态为true")]),e._v(" "),a("p",[e._v("当担保状态为false时，才可发起出售、捐赠或质押操作")])]),e._v(" "),0==e.drugRequestList.length?a("div",{staticStyle:{"text-align":"center"}},[a("el-alert",{attrs:{title:"查询不到数据",type:"warning"}})],1):e._e(),e._v(" "),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{gutter:20}},e._l(e.drugRequestList,function(t,o){return a("el-col",{key:o,attrs:{span:6,offset:1}},[a("el-card",{staticClass:"drugRequest-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("\n          担保状态:\n          "),a("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[e._v(e._s(t.encumbrance))])]),e._v(" "),a("div",{staticClass:"item"},[a("el-tag",[e._v("药品ID: ")]),e._v(" "),a("span",[e._v(e._s(t.drugRequestId))])],1),e._v(" "),a("div",{staticClass:"item"},[a("el-tag",{attrs:{type:"success"}},[e._v("用户ID: ")]),e._v(" "),a("span",[e._v(e._s(t.proprietor))])],1),e._v(" "),a("div",{staticClass:"item"},[a("el-tag",{attrs:{type:"warning"}},[e._v("药品名称: ")]),e._v(" "),a("span",[e._v(e._s(t.drugName))])],1),e._v(" "),a("div",{staticClass:"item"},[a("el-tag",{attrs:{type:"warning"}},[e._v("商品名称: ")]),e._v(" "),a("span",[e._v(e._s(t.tradeName))])],1),e._v(" "),a("div",{staticClass:"item"},[a("el-tag",{attrs:{type:"danger"}},[e._v("数量: ")]),e._v(" "),a("span",[e._v(e._s(t.drugNumber)+" 件")])],1),e._v(" "),t.encumbrance||t.proprietor===e.accountId||"admin"===e.roles[0]?e._e():a("div",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.openDialog(t)}}},[e._v("出售给ta")]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.openDonatingDialog(t)}}},[e._v("捐赠给ta")])],1),e._v(" "),t.proprietor==e.accountId||"admin"===e.roles[0]?a("el-rate"):e._e()],1)],1)}),1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingDialog,expression:"loadingDialog"}],attrs:{visible:e.dialogCreateSelling,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogCreateSelling=t},close:function(t){return e.resetForm("realForm")}}},[a("el-form",{ref:"realForm",attrs:{model:e.realForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"价格 (元)",prop:"price"}},[a("el-input-number",{attrs:{precision:2,step:1e4,min:0},model:{value:e.realForm.price,callback:function(t){e.$set(e.realForm,"price",t)},expression:"realForm.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有效期 (天)",prop:"salePeriod"}},[a("el-input-number",{attrs:{min:1},model:{value:e.realForm.salePeriod,callback:function(t){e.$set(e.realForm,"salePeriod",t)},expression:"realForm.salePeriod"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createSelling("realForm")}}},[e._v("立即出售")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogCreateSelling=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingDialog,expression:"loadingDialog"}],attrs:{visible:e.dialogCreateDonating,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogCreateDonating=t},close:function(t){return e.resetForm("DonatingForm")}}},[a("el-form",{ref:"DonatingForm",attrs:{model:e.DonatingForm,rules:e.rulesDonating,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户",prop:"proprietor"}},[a("el-select",{attrs:{placeholder:"请选择用户"},on:{change:e.selectGet},model:{value:e.DonatingForm.proprietor,callback:function(t){e.$set(e.DonatingForm,"proprietor",t)},expression:"DonatingForm.proprietor"}},e._l(e.accountList,function(t){return a("el-option",{key:t.accountId,attrs:{label:t.userName,value:t.accountId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.userName))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.accountId))])])}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createDonating("DonatingForm")}}},[e._v("立即捐赠")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogCreateDonating=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(u,g,!1,function(e){a("HuSN")},null,null);t.default=d.exports}});
//# sourceMappingURL=5.f3651deb4bea68d461cc.js.map